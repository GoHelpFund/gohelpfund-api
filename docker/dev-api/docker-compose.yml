version: '2'

networks:
  default:
    driver: bridge

services:
  eureka-server:
    image:   gohelpfund/ghf-eureka-server:${BUILD_NAME}
    cpu_shares: 100
    mem_limit: 512MB
    ports:
      - "8761:8761"
    environment:
      PROFILE: "dev-api"
    networks:
      default:
        aliases:
          - eureka-server

  config-server:
    image: gohelpfund/ghf-config-server:${BUILD_NAME}
    cpu_shares: 100
    mem_limit: 512MB
    ports:
      - "8762:8762"
    links:
      - "eureka-server:eureka-server"
    networks:
      default:
        aliases:
          - config-server
    environment:
      PROFILE:                  "dev-api"
      EUREKASERVER_URI:         "http://eureka-server:8761/eureka/"
      SERVER_PORT:              "8762"
      EUREKASERVER_PORT:        "8761"
      ENCRYPT_KEY:              $SYMMETRIC_ENCRYPTION_KEY
      GIT_URI:                  $GIT_CONFIG_REPO_URI
      GIT_USERNAME:             $GIT_CONFIG_REPO_USERNAME
      GIT_PASSWORD:             $GIT_CONFIG_REPO_PASSWORD

  zuul-server:
    image: gohelpfund/ghf-zuul-server:${BUILD_NAME}
    cpu_shares: 448
    mem_limit: 2048MB
    ports:
      - "443:8763"
    links:
      - "eureka-server:eureka-server"
      - "config-server:config-server"
      - "authentication-service:authentication-service"
      - "fundraiser-service:fundraiser-service"
      - "campaign-service:campaign-service"
    networks:
      default:
        aliases:
          - zuul-server
    environment:
      PROFILE:                  "dev-api"
      SERVER_PORT:              "8763"
      ANALYTICS_KEY:            "84rYLp2FgMyG0zfFkNpFSQMLACBYmFZa"
      EUREKASERVER_URI:         "http://eureka-server:8761/eureka/"
      ZIPKIN_URI:               "http://zipkin-server:9411"
      CONFIGSERVER_URI:         "http://config-server:8762"
      ZIPKIN_PORT:              "9411"
      CATEGORYSERVERNEW_PORT:   "9102"
      CONFIGSERVER_PORT:        "8762"
      EUREKASERVER_PORT:        "8761"

  authentication-service:
    image: gohelpfund/ghf-authentication-service:${BUILD_NAME}
    cpu_shares: 400
    mem_limit: 1024MB
    ports:
      - "8764:8764"
    links:
      - "config-server:config-server"
      - "eureka-server:eureka-server"
    networks:
      default:
        aliases:
          - authentication-service
    environment:
      PROFILE:                  "dev-api"
      EUREKASERVER_URI:         "http://eureka-server:8761/eureka/"
      CONFIGSERVER_URI:         "http://config-server:8762"
      DATABASESERVER_URI:       "private-dev-db-do-user-4043556-0.db.ondigitalocean.com"
      DATABASESERVER_PORT:      "25060"
      CAMPAIGN_SERVICE_PORT:    "9100"
      SERVER_PORT:              "8764"
      ZUULSERVER_PORT:          "8763"
      CONFIGSERVER_PORT:        "8762"
      EUREKASERVER_PORT:        "8761"
      ENCRYPT_KEY:              $SYMMETRIC_ENCRYPTION_KEY

  donation-service:
    image: gohelpfund/ghf-donation-service:${BUILD_NAME}
    cpu_shares: 300
    mem_limit: 2048MB
    ports:
      - "9000:9000"
    links:
      - "authentication-service:authentication-service"
      - "config-server:config-server"
      - "eureka-server:eureka-server"
    networks:
      default:
        aliases:
          - donation-service
    environment:
      PROFILE:                  "dev-api"
      EUREKASERVER_URI:         "http://eureka-server:8761/eureka/"
      CONFIGSERVER_URI:         "http://config-server:8762"
      AUTHSERVER_URI:           "http://authentication-service:8764/api/v1/auth/user"
      DATABASESERVER_URI:       "private-dev-db-do-user-4043556-0.db.ondigitalocean.com"
      DATABASESERVER_PORT:      "25060"
      SERVER_PORT:              "9000"
      AUTHSERVER_PORT:          "8764"
      ZUULSERVER_PORT:          "8763"
      CONFIGSERVER_PORT:        "8762"
      EUREKASERVER_PORT:        "8761"
      ZKSERVER_PORT:            "2181"
      ENCRYPT_KEY:              $SYMMETRIC_ENCRYPTION_KEY

  campaign-service:
    image: gohelpfund/ghf-campaign-service:${BUILD_NAME}
    cpu_shares: 400
    mem_limit: 1024MB
    ports:
      - "9100:9100"
    extra_hosts:
      - "kafka-server:10.135.186.161"
    links:
      - "authentication-service:authentication-service"
      - "donation-service:donation-service"
      - "config-server:config-server"
      - "eureka-server:eureka-server"
    networks:
      default:
        aliases:
          - campaign-service
    environment:
      PROFILE:                  "dev-api"
      EUREKASERVER_URI:         "http://eureka-server:8761/eureka/"
      ZIPKIN_URI:               "http://zipkin-server:9411"
      CONFIGSERVER_URI:         "http://config-server:8762"
      AUTHSERVER_URI:           "http://authentication-service:8764/api/v1/auth/user"
      KAFKASERVER_URI:          "kafka-server"
      ZKSERVER_URI:             "kafka-server"
      REDIS_URI:                "private-dev-redis-do-user-4043556-0.db.ondigitalocean.com"
      DATABASESERVER_URI:       "private-dev-db-do-user-4043556-0.db.ondigitalocean.com"
      REDIS_PORT:               "25061"
      DATABASESERVER_PORT:      "25060"
      ZIPKIN_PORT:              "9411"
      SERVER_PORT:              "9100"
      KAFKASERVER_PORT:         "9092"
      DONATION_PORT:            "9000"
      AUTHSERVER_PORT:          "8764"
      ZUULSERVER_PORT:          "8763"
      CONFIGSERVER_PORT:        "8762"
      EUREKASERVER_PORT:        "8761"
      ZKSERVER_PORT:            "2181"
      ENCRYPT_KEY:              $SYMMETRIC_ENCRYPTION_KEY

  fundraiser-service:
    image: gohelpfund/ghf-fundraiser-service:${BUILD_NAME}
    cpu_shares: 100
    mem_limit: 1024MB
    ports:
      - "9200:9200"
    extra_hosts:
      - "kafka-server:157.230.123.31"
    links:
      - "authentication-service:authentication-service"
      - "donation-service:donation-service"
      - "config-server:config-server"
      - "eureka-server:eureka-server"
    networks:
      default:
        aliases:
          - fundraiser-service
    environment:
      PROFILE:                  "dev-api"
      EUREKASERVER_URI:         "http://eureka-server:8761/eureka/"
      ZIPKIN_URI:               "http://zipkin-server:9411"
      CONFIGSERVER_URI:         "http://config-server:8762"
      AUTHSERVER_URI:           "http://authentication-service:8764/api/v1/auth/user"
      KAFKASERVER_URI:          "kafka-server"
      ZKSERVER_URI:             "kafka-server"
      DATABASESERVER_URI:       "private-dev-db-do-user-4043556-0.db.ondigitalocean.com"
      DATABASESERVER_PORT:      "25060"
      ZIPKIN_PORT:              "9411"
      SERVER_PORT:              "9200"
      KAFKASERVER_PORT:         "9092"
      DONATION_PORT:            "9000"
      AUTHSERVER_PORT:          "8764"
      ZUULSERVER_PORT:          "8763"
      CONFIGSERVER_PORT:        "8762"
      EUREKASERVER_PORT:        "8761"
      ZKSERVER_PORT:            "2181"
      ENCRYPT_KEY:              $SYMMETRIC_ENCRYPTION_KEY